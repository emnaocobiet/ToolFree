<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LC79 Minimal</title>
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; }
        #bg-iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none; }

        #floating-box {
            position: absolute;
            top: 20px;
            left: 20px;
            width: 140px; /* Nhỏ gọn hơn */
            height: 90px;
            background: #fff; /* Nền trắng tinh */
            color: #000; /* Chữ đen */
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            cursor: move;
            user-select: none;
            z-index: 9999;
            box-shadow: 0 5px 15px rgba(0,0,0,0.4);
            font-family: Arial, sans-serif;
            font-weight: bold;
        }

        /* Dòng 1: Phiên hiện tại */
        .phien-hien-tai { font-size: 16px; margin-bottom: 5px; color: #333; }
        /* Dòng 2: Dự đoán */
        .du-doan { font-size: 26px; text-transform: uppercase; color: #000; }
        
        /* Trạng thái Thắng/Thua (1 dòng duy nhất) */
        .status { font-size: 24px; }
        .win { color: #27ae60; }
        .lose { color: #c0392b; }
    </style>
</head>
<body>

    <iframe id="bg-iframe" src="https://play.lc79.bet/"></iframe>

    <div id="floating-box">
        <div id="content">Đang tải...</div>
    </div>

    <script>
        const box = document.getElementById('floating-box');
        const content = document.getElementById('content');
        const proxies = [
            'https://api.allorigins.win/get?url=',
            'https://api.codetabs.com/v1/proxy/?quest='
        ];
        
        let proxyIdx = 0;
        let lastPred = null;
        let isShowingResult = false;

        // Kéo thả (Mobile & PC)
        let isDrag = false, ox, oy;
        const start = (e) => { isDrag = true; ox = (e.clientX || e.touches[0].clientX) - box.offsetLeft; oy = (e.clientY || e.touches[0].clientY) - box.offsetTop; };
        const move = (e) => { if(!isDrag) return; box.style.left = ((e.clientX || e.touches[0].clientX) - ox) + 'px'; box.style.top = ((e.clientY || e.touches[0].clientY) - oy) + 'px'; };
        const end = () => isDrag = false;

        box.addEventListener('mousedown', start); box.addEventListener('touchstart', start);
        document.addEventListener('mousemove', move); document.addEventListener('touchmove', move);
        document.addEventListener('mouseup', end); document.addEventListener('touchend', end);

        async function update() {
            if (isShowingResult) return;
            try {
                const target = 'https://lc79md5.vercel.app/lc79/md5';
                const res = await fetch(proxies[proxyIdx] + encodeURIComponent(target));
                let data = await res.json();
                if (proxyIdx === 0) data = JSON.parse(data.contents);

                // Logic so sánh kết quả phiên trước
                if (lastPred && data.phien === lastPred.phien_hien_tai) {
                    isShowingResult = true;
                    const win = data.ket_qua === lastPred.du_doan;
                    content.innerHTML = `<div class="status ${win?'win':'lose'}">${win?'THẮNG':'THUA'}</div>`;
                    lastPred = null;
                    setTimeout(() => { isShowingResult = false; }, 3000); // Hiện 3 giây rồi mất
                    return;
                }

                // Hiển thị nội dung chính
                content.innerHTML = `
                    <div class="phien-hien-tai">${data.phien_hien_tai}</div>
                    <div class="du-doan">${data.du_doan}</div>
                `;
                
                lastPred = { phien_hien_tai: data.phien_hien_tai, du_doan: data.du_doan };
            } catch (e) {
                proxyIdx = (proxyIdx + 1) % proxies.length;
            }
        }

        setInterval(update, 3000);
        update();
    </script>
</body>
</html>
